import csv
import os

import opcode_sequence
import pandas as pd
from androguard.core.bytecodes import apk
from androguard.misc import AnalyzeAPK

data_path = '/home/mkr/Desktop/projects/python/databases/cic_and_mal_2017/train_opseq'


def divider_str():
    print '-----------------------'


def get_apks_fullpathes():
    malware_classes_names = []
    for (dirpath, dirnames, filenames) in os.walk(data_path):
        malware_classes_names.extend(dirnames)
        break

    malware_classes_apks_paths = []

    for malware_class_name in malware_classes_names:
        malware_class_path = '%s/%s' % (data_path, malware_class_name)
        class_apks = []
        for (dirpath, dirnames, filenames) in os.walk(malware_class_path):
            for filename in filenames:
                apk_path = '%s/%s' % (malware_class_path, filename)
                class_apks.append(apk_path)
        malware_classes_apks_paths.append(class_apks)
    return malware_classes_apks_paths


# Use it ONLY if your apk files separated in theirs category folders
def create_csv():
    divider_str()

    with open('trainLabels.csv', 'wb') as csvfile:
        filewriter = csv.writer(csvfile, delimiter=',', quotechar='|', quoting=csv.QUOTE_MINIMAL)
        filewriter.writerow(['Id', 'Class'])

        class_num = 1
        for class_apks_path in get_apks_fullpathes():
            for apk_path in class_apks_path:
                apk_name = os.path.basename(apk_path)
                filewriter.writerow([apk_name.replace('.opseq', ''), class_num])
            class_num += 1

create_csv()
