import os

import matplotlib.pyplot as plt
import networkx as nx
import graph_utils
from androguard.misc import AnalyzeAPK


def create_and_save_graph(path_to_apk):
    a, d, dx = AnalyzeAPK(path_to_apk)
    # print a.show()

    CFG = graph_utils.get_graph(a, d, dx)
    plt.figure(figsize=(10, 10))
    nx.draw_networkx(CFG, with_labels=True, font_size=14, width=1)
    plt.draw()
    plt.show()
    nx.write_gexf(CFG, '%s.graph' % os.path.basename(path_to_apk).replace(".apk", ""))


def read_and_show_graph(path_to_graph):
    CFG = nx.DiGraph(nx.read_gexf(path_to_graph))
    plt.figure(figsize=(10, 10))
    nx.draw_networkx(CFG, with_labels=True, font_size=14, width=1)
    plt.draw()
    plt.show()


if __name__ == '__main__':
    # create_and_save_graph("/home/mkr/Desktop/projects/python/databases/cic_and_mal_2017/train/Adware/5dc565a01bb789d8d171c20f52ac34c8.apk")
    read_and_show_graph("5dc565a01bb789d8d171c20f52ac34c8.graph")
