from androguard.misc import AnalyzeAPK, APK
from androguard.core.api_specific_resources import load_permissions

apk_file_path = '/home/mkr/Desktop/projects/python/databases/cic_and_mal_2017/test/samples/adware_2bcf8dd1233186ae267a67479fdd1e4b.apk'
# apk_file, d, dx = AnalyzeAPK(apk_file_path)
apk_file = APK(apk_file_path)


def display_services_features():
    print ''
    print 'Services features'
    for ser in apk_file.get_services():
        print '[%s]: %s' % (ser, apk_file.get_intent_filters('service', ser))


def display_receivers_features():
    print ''
    print 'Receivers features'
    for rec in apk_file.get_receivers():
        print '[%s]: %s' % (rec, apk_file.get_intent_filters('receiver', rec))


def display_activity_features():
    print ''
    print 'Activities features'
    for act in apk_file.get_activities():
        print '[%s]: %s' % (act, apk_file.get_intent_filters('activity', act))


def extract_intent_filters(type_name, type_list):
    res = []
    for type_item in type_list:
        type_item_ifs = apk_file.get_intent_filters(type_name, type_item).get('action')
        if type_item_ifs is not None:
            for type_item_if in type_item_ifs:
                res.append(type_item_if)
    return res


def get_all_intent_filters():
    intent_filters = []
    intent_filters.extend(extract_intent_filters('service', apk_file.get_services()))
    intent_filters.extend(extract_intent_filters('receiver', apk_file.get_receivers()))
    intent_filters.extend(extract_intent_filters('activity', apk_file.get_activities()))
    return intent_filters


def display_all_intent_filters():
    print '\n=Intent filters='
    for i_f in get_all_intent_filters():
        print i_f


def display_permissions():
    print '\n=Permissions='
    permissions = apk_file.get_permissions()
    print permissions

