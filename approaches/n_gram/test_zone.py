from sklearn.ensemble import RandomForestClassifier as RF
from sklearn.model_selection import train_test_split
import pandas as pd
from sklearn.svm import SVC
from sklearn.model_selection import GridSearchCV
from utils import constants, opcode_sequence

subtrainLabel = pd.read_csv(constants.CSV_SUBTRAIN)
subtrainfeature = pd.read_csv(constants.CSV_FEATURES_NGRAM)
subtrain = pd.merge(subtrainLabel, subtrainfeature, on='Id')
labels = subtrain.Class
subtrain.drop(["Class", "Id"], axis=1, inplace=True)
subtrain = subtrain.as_matrix()

X_train, X_test, y_train, y_test = train_test_split(subtrain, labels, test_size=0.2, random_state=0)


def svm_linear_method():
    clf = SVC(kernel='linear')
    clf.fit(X_train, y_train)
    clf_predictions = clf.predict(X_test)
    print("[SVC]: Accuracy: {}%".format(clf.score(X_test, y_test) * 100))


def svm_poly_method():
    clf = SVC(kernel='poly', degree=4)
    clf.fit(X_train, y_train)
    clf_predictions = clf.predict(X_test)
    print("[SVC]: Accuracy: {}%".format(clf.score(X_test, y_test) * 100))


def rf_method():
    srf = RF(n_estimators=500, n_jobs=-1)
    srf.fit(X_train, y_train)
    srf_predictions = srf.predict(X_test)
    print("[RF ]: Accuracy: {}%".format(srf.score(X_test, y_test) * 100))


def svm_best_params_method():
    # FIRST. Calculating the best params for SVM() method
    # param_grid = {'C': [0.1, 1, 10, 100], 'gamma': [1, 0.1, 0.01, 0.001, 0.00001, 10]}
    # clf_grid = GridSearchCV(SVC(), param_grid, verbose=1)
    # clf_grid.fit(X_train, y_train)
    # print("Best Parameters:\n", clf_grid.best_params_)
    # out: ('Best Parameters:\n', {'C': 10, 'gamma': 0.1})

    # SECOND. By using suggested params do prediction
    clf = SVC(kernel='rbf', C=10, gamma=0.1)
    clf.fit(X_train, y_train)
    clf_predictions = clf.predict(X_test)
    print("[SVC]: Accuracy: {}%".format(clf.score(X_test, y_test) * 100))


